InitLevel subroutine
	jsr SetPalette		
        jsr FillVRAM	
        jsr InitSprites
        
        jsr WaitSync
	lda #0
        sta PPU_ADDR
        sta PPU_ADDR		
        sta PPU_SCROLL
        sta PPU_SCROLL	
        lda #MASK_BG|MASK_SPR
        sta PPU_MASK 	; enable rendering
        lda #CTRL_NMI
        sta PPU_CTRL	; enable NMI
        
	rts


UpdateLevel subroutine
        clc
        lda scroll_pos + 1
        and #%00000001
        cmp #0
        bne .nextTable
        
        ldx #$24
        lda scroll_pos
       	bcc .loadSeam
        ldx #$20
        jmp .loadSeam

.nextTable:
	ldx #$20
        lda scroll_pos
       	bcc .loadSeam
        ldx #$24
        
.loadSeam:
	stx temp + 1
        lsr
        lsr
        lsr
        sta temp
        
        ldx #0
.checkRow:
	cpx #30
        beq .updatePlayerTile

      
	lda temp + 1
        sta PPU_ADDR
        lda temp
        sta PPU_ADDR
        lda Wall,x
        sta PPU_DATA
  	inx
        
        clc
        lda temp
        adc #32
        bcc .sameRow
        inc temp + 1
.sameRow:
	sta temp
        jmp .checkRow
        
.updatePlayerTile:
        clc
        lda game_state
        cmp #2
        beq .fillPlayerTile
        
        
        lda scroll_pos + 1
        and #%00000001
        cmp #1
        bne .opt2
        
        ldx #$24
        lda player_old_tile
        cmp #32
        bcc .optnr
        ldx #$20
        sbc #32
	ldy player_old_tile + 1
        jmp .optss
.opt2:
        ldx #$20
        lda player_old_tile
        cmp #32
        bcc .optnr
        ldx #$24
        sbc #32
.optnr:
	ldy player_old_tile + 1
.optss:
        cpy #0
        beq .optdr
        dey
        adc #31
        bcc .optsk
        inx
.optsk:
	jmp .optss
.optdr:
	stx PPU_ADDR
        sta PPU_ADDR
        lda #$00
        sta PPU_DATA

        rts
        

        
.fillPlayerTile:        
        
        
        
        lda scroll_pos + 1
        and #%00000001
        cmp #1
        bne .pt2
        
        ldx #$24
        lda player_tile
        cmp #32
        bcc .ptnr
        ldx #$20
        sbc #32
	ldy player_tile + 1
        jmp .ptss
.pt2:
        ldx #$20
        lda player_tile
        cmp #32
        bcc .ptnr
        ldx #$24
        sbc #32
.ptnr:
	ldy player_tile + 1
.ptss:
        cpy #0
        beq .ptdr
        dey
        adc #31
        bcc .ptsk
        inx
.ptsk:
	jmp .ptss
.ptdr:
	stx PPU_ADDR
        sta PPU_ADDR
        lda #$97
        sta PPU_DATA
        rts
        
        
Wall:
	hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 97 97 97 97
Level:
	hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        
	hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 0C 0C 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 0C 0C 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
 
        hex 97 97 00 00 0C 0C 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 0C 0C 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 0C 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 0C 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 0C 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 0C 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        hex FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF  FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF FF 
        
Level2:
	hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
	hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 0C 0C 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 0C 0C 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
 
        hex 97 97 00 00 0C 0C 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 0C 0C 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 0C 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 0C 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 0C 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 0C 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97