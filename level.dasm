InitLevel subroutine
	jsr SetPalette		
        jsr FillVRAM	
        jsr InitSprites
        
        jsr WaitSync
	lda #0
        sta PPU_ADDR
        sta PPU_ADDR		
        sta PPU_SCROLL
        sta PPU_SCROLL	
        lda #MASK_BG|MASK_SPR
        sta PPU_MASK 	; enable rendering
        lda #CTRL_NMI
        sta PPU_CTRL	; enable NMI
        
	rts


UpdateLevel subroutine      
	clc
	ldx #$20
        lda player_tile
        ldy player_tile + 1
        cmp #32
        bcc .firstTable
        ldx #$24
        sbc #32
.firstTable:
	clc
        cpy #0
        beq .correctRow
        dey
        adc #31
        bcc .noCarry
        inx
.noCarry:
        jmp .firstTable
.correctRow:
	stx player_old_tile
        sta player_old_tile + 1
	stx PPU_ADDR
        sta PPU_ADDR
        lda scroll_table
        sta PPU_DATA
	rts


    
	hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
	hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 0C 0C 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 0C 0C 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
 
        hex 97 97 00 00 0C 0C 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 0C 0C 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 0C 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 0C 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 0C 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 0C 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

        hex 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97

        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97
        
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97 
        hex 97 97 00 00 00 00 00 00 00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00 00 00 00 00 00 00 97 97
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  
        hex 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97  97 97 97 97 97 97 97 97 97 97 97 97 97 97 97 97